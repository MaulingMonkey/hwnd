fn main() {
    natvis::gen();
}

mod natvis {
    pub fn gen() {
        mmrbi::fs::write_if_modified_with("hwnd.natvis", |nv| {
            use std::io::{Write as _};

            writeln!(nv, r#"<?xml version="1.0" encoding="utf-8"?>"#)?;
            writeln!(nv, r#"<!-- WARNING: this file is auto-generated by xtask gen and may be overwritten -->"#)?;
            writeln!(nv)?;
            writeln!(nv, r#"<AutoVisualizer xmlns="http://schemas.microsoft.com/vstudio/debugger/natvis/2010">"#)?;

            writeln!(nv)?;
            writeln!(nv, r#"    <Type Name="hwnd::handles::hwnd_::HWnd">"#)?;
            writeln!(nv, r#"        <DisplayString>HWnd({{__0,X}})</DisplayString>"#)?;
            writeln!(nv, r#"    </Type>"#)?;
            writeln!(nv)?;
            writeln!(nv, r#"    <Type Name="hwnd::handles::hmodule::HModule">"#)?;
            writeln!(nv, r#"        <DisplayString>{{(HMODULE)__0}}</DisplayString>"#)?;
            writeln!(nv, r#"    </Type>"#)?;
            writeln!(nv)?;
            writeln!(nv, r#"    <Type Name="hwnd::handles::hcursor::HCursor">"#)?;
            writeln!(nv, r#"        <DisplayString>HCursor({{__0,X}})</DisplayString>"#)?;
            writeln!(nv, r#"    </Type>"#)?;

            writeln!(nv)?;
            writeln!(nv, r#"    <Type Name="hwnd::enums::WM::WM16">"#)?; // doesn't exist yet
            writeln!(nv, r#"        <DisplayString>{{__0,wm}}</DisplayString>"#)?;
            writeln!(nv, r#"    </Type>"#)?;

            writeln!(nv)?;
            writeln!(nv, r#"    <Type Name="hwnd::enums::WM::WM32">"#)?;
            writeln!(nv, r#"        <DisplayString>{{__0,wm}}</DisplayString>"#)?;
            writeln!(nv, r#"    </Type>"#)?;
            writeln!(nv)?;
            writeln!(nv, r#"    <Type Name="hwnd::enums::WS::WindowStyle">"#)?;
            // TODO: values
            writeln!(nv, r#"        <DisplayString>WS::??? ({{__0,X}})</DisplayString>"#)?;
            writeln!(nv, r#"    </Type>"#)?;
            writeln!(nv)?;
            writeln!(nv, r#"    <Type Name="hwnd::enums::WS_EX::WindowStyleExtended">"#)?;
            // TODO: values
            writeln!(nv, r#"        <DisplayString>WS_EX::??? ({{__0,X}})</DisplayString>"#)?;
            writeln!(nv, r#"    </Type>"#)?;

            writeln!(nv)?;
            writeln!(nv, r#"</AutoVisualizer>"#)
        }).unwrap();
    }
}
